(()=>{"use strict";var t=function(){function t(){this.left=new e,this.right=new e,this.up=new e}return t.prototype.keyDownUp=function(t,e){var i="keydown"==t;switch(e){case"ArrowLeft":this.left.getInput(i);break;case"ArrowUp":this.up.getInput(i);break;case"ArrowRight":this.right.getInput(i)}},t}(),e=function(){function t(){this.active=this.down=!1}return t.prototype.getInput=function(t){this.down!=t&&(this.active=t),this.down=t},t}(),i=function(t,e,i){this.image=new Image,this.tile_width=t,this.tile_height=e,this.columns=i},h=function(){function t(t){this.buffer=document.createElement("canvas").getContext("2d"),this.context=t.getContext("2d"),this.tile_sheet=new i(164,95,10)}return t.prototype.drawPlayer=function(t,e,i){this.buffer.fillStyle=e,this.buffer.fillRect(Math.round(t.x),Math.round(t.y),t.width,t.height),this.buffer.fillStyle=i,this.buffer.fillRect(Math.round(t.x+20),Math.round(t.y+20),t.width-40,t.height-40)},t.prototype.drawMap=function(t,e){this.buffer.drawImage(this.tile_sheet.image,0,475,1640,19,0,0,1640,19);for(var i=0;i<=t.length-1;i++){var h=t[i],n=h%this.tile_sheet.columns*this.tile_sheet.tile_width,s=Math.floor(h/this.tile_sheet.columns)*this.tile_sheet.tile_height,o=i%e*this.tile_sheet.tile_width,r=Math.floor(i/e)*this.tile_sheet.tile_height;this.buffer.drawImage(this.tile_sheet.image,n,s,this.tile_sheet.tile_width,this.tile_sheet.tile_height,o,r+19,this.tile_sheet.tile_width,this.tile_sheet.tile_height)}this.buffer.drawImage(this.tile_sheet.image,0,494,1640,31,0,589,1640,31),this.buffer.drawImage(this.tile_sheet.image,0,525,1640,260,0,620,1640,260),this.buffer.drawImage(this.tile_sheet.image,0,785,1640,59,0,880,1640,59)},t.prototype.fill=function(t){this.buffer.fillStyle=t,this.buffer.fillRect(0,0,this.buffer.canvas.width,this.buffer.canvas.height)},t.prototype.render=function(){this.context.drawImage(this.buffer.canvas,0,0,this.buffer.canvas.width,this.buffer.canvas.height,0,0,this.context.canvas.width,this.context.canvas.height)},t.prototype.resize=function(t,e,i){e/t>i?(this.context.canvas.height=t*i,this.context.canvas.width=t):(this.context.canvas.height=e,this.context.canvas.width=e/i),this.context.imageSmoothingEnabled=!1},t}(),n=function(){function t(t,e,i){var h=this;this.accumulated_time=0,this.animation_frame_request=void 0,this.time=0,this.time_step=t,this.updated=!1,this.update=e,this.render=i,this.handleRun=function(t){h.run(t)}}return t.prototype.run=function(t){for(this.accumulated_time+=t-this.time,this.time=t,this.accumulated_time>=3*this.time_step&&(this.accumulated_time=this.time_step);this.accumulated_time>=this.time_step;)this.accumulated_time-=this.time_step,this.update(t),this.updated=!0;this.updated&&(this.updated=!1,this.render(t)),this.animation_frame_request=window.requestAnimationFrame(this.handleRun)},t.prototype.start=function(){this.accumulated_time=this.time_step,this.time=window.performance.now(),this.animation_frame_request=window.requestAnimationFrame(this.handleRun)},t.prototype.stop=function(){window.cancelAnimationFrame(this.animation_frame_request)},t}(),s=function(){function t(){this.color1="#404040",this.color2="#f0f0f0",this.width=120,this.height=120,this.flying=!0,this.velocity_x=0,this.velocity_y=2,this.x=100,this.y=72,this.flying_loader=0}return t.prototype.fly=function(){this.flying=!0,this.flying_loader<1?this.flying_loader+=.04:this.velocity_y=-2},t.prototype.moveLeft=function(){this.velocity_x-=.5},t.prototype.moveRight=function(){this.velocity_x+=.5},t.prototype.update=function(){this.x+=this.velocity_x,this.y+=this.velocity_y},t}(),o=function(){function t(){this.background_color="rgb(40, 48, 56)",this.friction=.8,this.old_flying_loader=0,this.player=new s,this.columns=10,this.rows=6,this.map=[0,1,2,3,4,3,4,3,4,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,45,46,47,48,45,46,45,46],this.tile_width=164,this.tile_height=95,this.height=this.tile_height*this.rows+369,this.width=this.tile_width*this.columns}return t.prototype.collideObject=function(t){t.x<0?(t.x=0,t.velocity_x=0):t.x+t.width>this.width&&(t.x=this.width-t.width,t.velocity_x=0),t.y<0?(t.y=0,t.velocity_y=0):t.y+t.height>this.height&&(t.flying=!1,t.y=this.height-t.height,t.velocity_y=0)},t.prototype.update=function(){this.player.velocity_x*=this.friction,this.player.update(),this.collideObject(this.player)},t}(),r=function(){function t(){this.world=new o}return t.prototype.update=function(){this.world.update()},t}();window.addEventListener("load",(function(){var e=function(t){s.keyDownUp(t.type,t.code)},i=function(){o.resize(document.documentElement.clientWidth-32,document.documentElement.clientHeight-32,a.world.height/a.world.width),o.render()},s=new t,o=new h(document.querySelector("canvas")),a=new r,l=new n(1e3/30,(function(){o.drawMap(a.world.map,a.world.columns),o.drawPlayer(a.world.player,a.world.player.color1,a.world.player.color2),o.render()}),(function(){s.left.active&&a.world.player.moveLeft(),s.right.active&&a.world.player.moveRight(),s.up.active&&a.world.player.fly(),a.update()}));o.buffer.canvas.height=a.world.height,o.buffer.canvas.width=a.world.width,o.tile_sheet.image.addEventListener("load",(function(){i(),l.start()}),{once:!0}),o.tile_sheet.image.src="images/map.png",window.addEventListener("keydown",e),window.addEventListener("keyup",e),window.addEventListener("resize",i)}))})();