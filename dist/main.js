(()=>{"use strict";var t=function(){function t(){this.left=new e,this.right=new e,this.up=new e}return t.prototype.keyDownUp=function(t,e){var i="keydown"==t;switch(e){case"ArrowLeft":this.left.getInput(i);break;case"ArrowUp":this.up.getInput(i);break;case"ArrowRight":this.right.getInput(i)}},t}(),e=function(){function t(){this.active=this.down=!1}return t.prototype.getInput=function(t){this.down!=t&&(this.active=t),this.down=t},t}(),i=function(t,e,i){this.image=new Image,this.tile_width=t,this.tile_height=e,this.columns=i},h=function(){function t(t){this.buffer=document.createElement("canvas").getContext("2d"),this.context=t.getContext("2d"),this.tile_sheet=new i(164,95,10)}return t.prototype.drawPlayer=function(t,e,i){this.buffer.fillStyle=e,this.buffer.fillRect(Math.floor(t.x),Math.floor(t.y),t.width,t.height),this.buffer.fillStyle=i,this.buffer.fillRect(Math.floor(t.x+20),Math.floor(t.y+20),t.width-40,t.height-40)},t.prototype.drawMap=function(t){for(var e=59;e>-1;--e){var i=e%this.tile_sheet.columns*this.tile_sheet.tile_width,h=Math.floor(e/this.tile_sheet.columns)*this.tile_sheet.tile_height,n=e%t*this.tile_sheet.tile_width,o=Math.floor(e/t)*this.tile_sheet.tile_height;this.buffer.drawImage(this.tile_sheet.image,i,h,this.tile_sheet.tile_width,this.tile_sheet.tile_height,n,o,this.tile_sheet.tile_width,this.tile_sheet.tile_height)}},t.prototype.fill=function(t){this.buffer.fillStyle=t,this.buffer.fillRect(0,0,this.buffer.canvas.width,this.buffer.canvas.height)},t.prototype.render=function(){this.context.drawImage(this.buffer.canvas,0,0,this.buffer.canvas.width,this.buffer.canvas.height,0,0,this.context.canvas.width,this.context.canvas.height)},t.prototype.resize=function(t,e,i){e/t>i?(this.context.canvas.height=t*i,this.context.canvas.width=t):(this.context.canvas.height=e,this.context.canvas.width=e/i),this.context.imageSmoothingEnabled=!1},t}(),n=function(){function t(t,e,i){var h=this;this.accumulated_time=0,this.animation_frame_request=void 0,this.time=0,this.time_step=t,this.updated=!1,this.update=e,this.render=i,this.handleRun=function(t){h.run(t)}}return t.prototype.run=function(t){for(this.accumulated_time+=t-this.time,this.time=t,this.accumulated_time>=3*this.time_step&&(this.accumulated_time=this.time_step);this.accumulated_time>=this.time_step;)this.accumulated_time-=this.time_step,this.update(t),this.updated=!0;this.updated&&(this.updated=!1,this.render(t)),this.animation_frame_request=window.requestAnimationFrame(this.handleRun)},t.prototype.start=function(){this.accumulated_time=this.time_step,this.time=window.performance.now(),this.animation_frame_request=window.requestAnimationFrame(this.handleRun)},t.prototype.stop=function(){window.cancelAnimationFrame(this.animation_frame_request)},t}(),o=function(){function t(){this.color1="#404040",this.color2="#f0f0f0",this.width=120,this.height=120,this.flying=!0,this.velocity_x=0,this.velocity_y=2,this.x=100,this.y=72,this.flying_loader=0}return t.prototype.fly=function(){this.flying=!0,this.flying_loader<1?this.flying_loader+=.04:this.velocity_y=-2},t.prototype.moveLeft=function(){this.velocity_x-=.5},t.prototype.moveRight=function(){this.velocity_x+=.5},t.prototype.update=function(){this.x+=this.velocity_x,this.y+=this.velocity_y},t}(),s=function(){function t(){this.background_color="rgb(40, 48, 56)",this.friction=.8,this.old_flying_loader=0,this.player=new o,this.columns=10,this.rows=6,this.tile_width=164,this.tile_height=95,this.height=this.tile_height*this.rows,this.width=this.tile_width*this.columns}return t.prototype.collideObject=function(t){t.x<0?(t.x=0,t.velocity_x=0):t.x+t.width>this.width&&(t.x=this.width-t.width,t.velocity_x=0),t.y<0?(t.y=0,t.velocity_y=0):t.y+t.height>this.height&&(t.flying=!1,t.y=this.height-t.height,t.velocity_y=0)},t.prototype.update=function(){this.player.velocity_x*=this.friction,this.player.update(),this.collideObject(this.player),console.log(this.player.velocity_y)},t}(),r=function(){function t(){this.world=new s}return t.prototype.update=function(){this.world.update()},t}();window.addEventListener("load",(function(){var e=function(t){o.keyDownUp(t.type,t.code)},i=function(){s.resize(document.documentElement.clientWidth-32,document.documentElement.clientHeight-32,l.world.height/l.world.width),console.log(document.documentElement.clientWidth-32,document.documentElement.clientHeight-32),s.render()},o=new t,s=new h(document.querySelector("canvas")),l=new r,a=new n(1e3/30,(function(){s.drawMap(l.world.columns),s.drawPlayer(l.world.player,l.world.player.color1,l.world.player.color2),s.render()}),(function(){o.left.active&&l.world.player.moveLeft(),o.right.active&&l.world.player.moveRight(),o.up.active&&l.world.player.fly(),l.update()}));s.buffer.canvas.height=l.world.height,s.buffer.canvas.width=l.world.width,s.tile_sheet.image.addEventListener("load",(function(){i(),a.start()}),{once:!0}),s.tile_sheet.image.src="images/mapa.png",window.addEventListener("keydown",e),window.addEventListener("keyup",e),window.addEventListener("resize",i)}))})();