(()=>{"use strict";var t,e=function(){function t(){this.left=new i,this.right=new i,this.up=new i}return t.prototype.keyDownUp=function(t,e){var i="keydown"==t;switch(e){case"ArrowLeft":this.left.getInput(i);break;case"ArrowUp":this.up.getInput(i);break;case"ArrowRight":this.right.getInput(i)}},t}(),i=function(){function t(){this.active=this.down=!1}return t.prototype.getInput=function(t){this.down!=t&&(this.active=t),this.down=t},t}(),o=function(){function t(t){this.buffer=document.createElement("canvas").getContext("2d"),this.context=t.getContext("2d")}return t.prototype.drawObject=function(t,e,i,o,r,l,n,s,h){this.buffer.drawImage(t,e,i,l,n,Math.round(o),Math.round(r),s,h)},t.prototype.drawMap=function(t,e,i,o,r,l){this.buffer.drawImage(t,0,475,1640,19,0,0,1640,19);for(var n=0;n<=i.length-1;n++){var s=i[n],h=s%e*r,a=Math.floor(s/e)*l,f=n%o*r,c=Math.floor(n/o)*l;this.buffer.drawImage(t,h,a,r,l,f,c+19,r,l)}this.buffer.drawImage(t,0,494,1640,31,0,589,1640,31),this.buffer.drawImage(t,0,525,1640,260,0,620,1640,260),this.buffer.drawImage(t,0,785,1640,59,0,880,1640,59)},t.prototype.fill=function(t){this.buffer.fillStyle=t,this.buffer.fillRect(0,0,this.buffer.canvas.width,this.buffer.canvas.height)},t.prototype.render=function(){this.context.drawImage(this.buffer.canvas,0,0,this.buffer.canvas.width,this.buffer.canvas.height,0,0,this.context.canvas.width,this.context.canvas.height)},t.prototype.resize=function(t,e,i){e/t>i?(this.context.canvas.height=t*i,this.context.canvas.width=t):(this.context.canvas.height=e,this.context.canvas.width=e/i),this.context.imageSmoothingEnabled=!0},t}(),r=function(){function t(t,e,i){var o=this;this.accumulated_time=0,this.animation_frame_request=void 0,this.time=0,this.time_step=t,this.updated=!1,this.update=e,this.render=i,this.handleRun=function(t){o.run(t)}}return t.prototype.run=function(t){for(this.accumulated_time+=t-this.time,this.time=t,this.accumulated_time>=3*this.time_step&&(this.accumulated_time=this.time_step);this.accumulated_time>=this.time_step;)this.accumulated_time-=this.time_step,this.update(t),this.updated=!0;this.updated&&(this.updated=!1,this.render(t)),this.animation_frame_request=window.requestAnimationFrame(this.handleRun)},t.prototype.start=function(){this.accumulated_time=this.time_step,this.time=window.performance.now(),this.animation_frame_request=window.requestAnimationFrame(this.handleRun)},t.prototype.stop=function(){window.cancelAnimationFrame(this.animation_frame_request)},t}(),l=function(){function t(){}return t.prototype.collidePlatformBottom=function(t,e){return t.getTop()<e&&t.getOldTop()>=e&&(t.setTop(e),t.velocity_y=0,!0)},t.prototype.collideRightPlatformBottom=function(t,e,i,o){return t.getTop()<e&&t.getOldTop()>=e&&t.getLeft()<i+o&&(t.setTop(e),t.velocity_y=0,!0)},t.prototype.collideLeftPlatformBottom=function(t,e,i,o){return t.getTop()<e&&t.getOldTop()>=e&&t.getRight()>i&&(t.setTop(e),t.velocity_y=0,!0)},t.prototype.collidePlatformTop=function(t,e){return t.getBottom()>e&&t.getOldBottom()<=e&&(t.setBottom(e-.01),t.velocity_y=0,t.flying=!1,!0)},t.prototype.collideRightPlatformTop=function(t,e,i,o){return t.getBottom()>e&&t.getOldBottom()<=e&&t.getLeft()<i+o?(t.setBottom(e-.01),t.velocity_y=0,t.flying=!1,!0):(t.flying=!0,!1)},t.prototype.collideLeftPlatformTop=function(t,e,i,o){return t.getBottom()>e&&t.getOldBottom()<=e&&t.getRight()>i?(t.setBottom(e-.01),t.velocity_y=0,t.flying=!1,!0):(t.flying=!0,!1)},t.prototype.collidePlatformLeft=function(t,e){return t.getRight()>e&&t.getOldRight()<=e&&(t.setRight(e-.01),t.velocity_x=0,!0)},t.prototype.collidePlatformRight=function(t,e){return t.getLeft()<e&&t.getOldLeft()>=e&&(t.setLeft(e),t.velocity_x=0,!0)},t.prototype.collide=function(t,e,i,o,r,l){switch(o+=19,t){case 0:break;case 1:if(this.collidePlatformTop(e,o))return;break;case 2:if(this.collidePlatformRight(e,i+r))return;break;case 3:if(this.collidePlatformTop(e,o))return;if(this.collidePlatformRight(e,i+r))return;break;case 4:if(this.collidePlatformBottom(e,o+l))return;break;case 5:if(this.collidePlatformTop(e,o))return;if(this.collidePlatformBottom(e,o+l))return;break;case 6:if(this.collidePlatformRight(e,i+r))return;if(this.collidePlatformBottom(e,o+l))return;break;case 7:if(this.collidePlatformTop(e,o))return;if(this.collidePlatformRight(e,i+r))return;if(this.collidePlatformBottom(e,o+l))return;break;case 8:if(this.collidePlatformLeft(e,i))return;break;case 9:if(this.collidePlatformTop(e,o))return;if(this.collidePlatformLeft(e,i))return;break;case 10:if(this.collidePlatformLeft(e,i))return;if(this.collidePlatformRight(e,i+r))return;break;case 11:if(this.collidePlatformTop(e,o))return;if(this.collidePlatformLeft(e,i))return;if(this.collidePlatformRight(e,i+r))return;break;case 12:if(this.collidePlatformLeft(e,i))return;if(this.collidePlatformBottom(e,o+l))return;break;case 13:if(this.collidePlatformTop(e,o))return;if(this.collidePlatformLeft(e,i))return;if(this.collidePlatformBottom(e,o+l))return;break;case 14:if(this.collidePlatformLeft(e,i))return;if(this.collidePlatformRight(e,i))return;if(this.collidePlatformBottom(e,o+l))return;break;case 15:if(this.collidePlatformTop(e,o))return;if(this.collidePlatformLeft(e,i))return;if(this.collidePlatformRight(e,i+r))return;if(this.collidePlatformBottom(e,o+l))return;break;case 16:if(this.collidePlatformRight(e,i+r/4))return;break;case 17:if(this.collidePlatformLeft(e,i+3*r/4))return;break;case 18:if(this.collideRightPlatformBottom(e,o+l,i,r/4))return;if(this.collidePlatformRight(e,i+r/4))return;break;case 19:if(this.collideLeftPlatformBottom(e,o+l,i+3*r/4,r/4))return;if(this.collidePlatformLeft(e,i+3*r/4))return;break;case 20:if(this.collideRightPlatformTop(e,o,i,r/2))return;if(e.flying=!0,this.collidePlatformRight(e,i+r/2))return;break;case 21:if(this.collideLeftPlatformTop(e,o,i+r/2,r/2))return;if(e.flying=!0,this.collidePlatformLeft(e,i+r/2))return;break;case 22:if(this.collidePlatformRight(e,i+r/2))return;break;case 23:if(this.collidePlatformLeft(e,i+r/2))return}},t}(),n=function(){function t(t,e){this.count=0,this.delay=e>=1?e:1,this.frame_set=t,this.frame_index=0,this.frame_value=t[0],this.mode="pause"}return t.prototype.animate=function(){"loop"===this.mode&&this.loop()},t.prototype.changeFrameSet=function(t,e,i,o){void 0===i&&(i=10),void 0===o&&(o=0),this.frame_set!==t&&(this.count=0,this.delay=i,this.frame_set=t,this.frame_index=o,this.frame_value=t[o],this.mode=e)},t.prototype.loop=function(){for(this.count++;this.count>this.delay;)this.count-=this.delay,this.frame_index=this.frame_index<this.frame_set.length-1?this.frame_index+1:0,this.frame_value=this.frame_set[this.frame_index]},t}(),s=(t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)},function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}),h=function(t){function e(e,i,o,r){var l=t.call(this,[0,1,2,1],1)||this;return l.x=e,l.y=i,l.width=o,l.height=r,l.direction_x=1,l.animation_delay=1,l.set=[0,1,2,1],l}return s(e,t),e.prototype.updateAnimation=function(){this.changeFrameSet(this.set,"loop",this.animation_delay)},e}(n),a=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),f=function(t){function e(e,i,o){var r=t.call(this,o["fly-left"],10)||this;return r.color1="#404040",r.color2="#f0f0f0",r.width=69,r.height=97,r.flying=!0,r.velocity_x=0,r.velocity_y=0,r.x=e,r.y=i,r.x_old=r.x,r.y_old=r.y,r.flying_loader=0,r.falling_loader=0,r.direction_x=1,r.player_sets=o,r.helicopter=new h(e,i,48,13.5),r}return a(e,t),e.prototype.fly=function(){this.helicopter.animation_delay=1,this.falling_loader=0,0==this.flying_loader&&(this.helicopter.delay=1),this.flying_loader<1?(this.flying_loader+=.08,this.velocity_y=0):(this.flying=!0,this.velocity_y=-10)},e.prototype.fall=function(){this.helicopter.animation_delay=5,this.flying_loader=0,this.falling_loader<1?(this.falling_loader+=.08,this.velocity_y=0):(this.flying=!0,this.velocity_y=10,this.helicopter.delay=5)},e.prototype.stop=function(){this.velocity_x=0},e.prototype.moveLeft=function(){this.direction_x=-1,this.velocity_x=-10},e.prototype.moveRight=function(){this.direction_x=1,this.velocity_x=10},e.prototype.updateAnimation=function(){this.flying?this.direction_x<0?this.changeFrameSet(this.player_sets["fly-left"],"pause"):this.changeFrameSet(this.player_sets["fly-right"],"pause"):this.direction_x<0?this.velocity_x<0?this.changeFrameSet(this.player_sets["walk-left"],"loop",2):this.changeFrameSet(this.player_sets["idle-left"],"pause"):this.direction_x>0&&(this.velocity_x>0?this.changeFrameSet(this.player_sets["walk-right"],"loop",2):this.changeFrameSet(this.player_sets["idle-right"],"pause")),this.animate(),this.helicopter.x=1==this.direction_x?this.x-9:this.x+30,this.helicopter.y=this.y-12,this.helicopter.updateAnimation(),this.helicopter.animate()},e.prototype.updatePosition=function(){this.x_old=this.x,this.y_old=this.y,this.x+=this.velocity_x,this.y+=this.velocity_y},e.prototype.getBottom=function(){return this.y+this.height},e.prototype.getLeft=function(){return this.x},e.prototype.getRight=function(){return this.x+this.width},e.prototype.getTop=function(){return this.y},e.prototype.getOldBottom=function(){return this.y_old+this.height},e.prototype.getOldLeft=function(){return this.x_old},e.prototype.getOldRight=function(){return this.x_old+this.width},e.prototype.getOldTop=function(){return this.y_old},e.prototype.setBottom=function(t){this.y=t-this.height},e.prototype.setLeft=function(t){this.x=t},e.prototype.setRight=function(t){this.x=t-this.width},e.prototype.setTop=function(t){this.y=t},e.prototype.setOldBottom=function(t){this.y_old=t-this.height},e.prototype.setOldLeft=function(t){this.x_old=t},e.prototype.setOldRight=function(t){this.x_old=t-this.width},e.prototype.setOldTop=function(t){this.y_old=t},e}(n),c=function(t,e,i,o,r,l){this.x=t,this.y=e,this.width=i,this.height=o,this.offset_x=r,this.offset_y=l},d=function(t,e,i){this.columns=t,this.tile_width=e,this.tile_height=i,this.player_frames=[new c(8,844,46,65,0,-10),new c(66,844,46,65,0,-10),new c(124,844,46,65,0,-10),new c(182,844,46,65,0,-10),new c(240,844,46,65,0,-10),new c(298,844,46,65,0,-10),new c(356,844,46,65,0,-10),new c(410,844,46,65,0,-10),new c(468,844,46,65,0,-10),new c(526,844,46,65,0,-10),new c(584,844,46,65,0,-10),new c(642,844,46,65,0,-10),new c(700,844,46,65,0,-10),new c(758,844,46,65,0,-10)],this.helicopter_frames=[new c(0,910,32,9,0,0),new c(32,910,32,9,0,0),new c(64,910,32,9,0,0)]},u=function(){function t(){this.collider=new l,this.player_sets={"fly-right":[0],"walk-right":[1,2,3,4,5],"idle-right":[6],"fly-left":[7],"walk-left":[8,9,10,11,12],"idle-left":[13]},this.player=new f(300,19,this.player_sets),this.columns=10,this.rows=6,this.tile_set=new d(10,164,95),this.map=[0,1,2,3,4,3,4,3,4,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,45,46,47,48,45,46,45,46],this.collision_map=[0,16,17,0,0,0,0,0,0,0,0,18,19,4,4,4,4,4,4,0,2,0,0,0,0,0,0,0,0,8,2,0,0,0,0,0,0,0,0,8,0,1,1,1,20,21,1,1,1,0,0,0,0,0,22,23,0,0,0,0],this.height=this.tile_set.tile_height*this.rows+369,this.width=this.tile_set.tile_width*this.columns}return t.prototype.collideObject=function(t){var e,i,o,r,l;t.getLeft()<0?(t.setLeft(0),t.velocity_x=0):t.getRight()>this.width&&(t.setRight(this.width),t.velocity_x=0),t.getTop()<19?(t.setTop(19),t.velocity_y=0):t.getBottom()>this.tile_set.tile_height*this.rows+19&&(t.setBottom(this.tile_set.tile_height*this.rows+19),t.velocity_y=0,t.flying=!1),r=Math.floor((t.getTop()-19)/this.tile_set.tile_height),i=Math.floor(t.getLeft()/this.tile_set.tile_width),l=this.collision_map[r*this.columns+i],this.collider.collide(l,t,i*this.tile_set.tile_width,r*this.tile_set.tile_height,this.tile_set.tile_width,this.tile_set.tile_height),r=Math.floor((t.getTop()-19)/this.tile_set.tile_height),o=Math.floor(t.getRight()/this.tile_set.tile_width),l=this.collision_map[r*this.columns+o],this.collider.collide(l,t,o*this.tile_set.tile_width,r*this.tile_set.tile_height,this.tile_set.tile_width,this.tile_set.tile_height),e=Math.floor((t.getBottom()-19)/this.tile_set.tile_height),i=Math.floor(t.getLeft()/this.tile_set.tile_width),l=this.collision_map[e*this.columns+i],this.collider.collide(l,t,i*this.tile_set.tile_width,e*this.tile_set.tile_height,this.tile_set.tile_width,this.tile_set.tile_height),e=Math.floor((t.getBottom()-19)/this.tile_set.tile_height),o=Math.floor(t.getRight()/this.tile_set.tile_width),l=this.collision_map[e*this.columns+o],this.collider.collide(l,t,o*this.tile_set.tile_width,e*this.tile_set.tile_height,this.tile_set.tile_width,this.tile_set.tile_height)},t.prototype.update=function(){this.player.updatePosition(),this.collideObject(this.player),this.player.updateAnimation()},t}(),p=function(){function t(){this.world=new u}return t.prototype.update=function(){this.world.update()},t}(),m=function(){function t(){this.tile_set_image=new Image}return t.prototype.loadTileSetImage=function(t,e){this.tile_set_image.addEventListener("load",(function(){e()}),{once:!0}),this.tile_set_image.src=t},t}();window.addEventListener("load",(function(){var t=function(t){n.keyDownUp(t.type,t.code)},i=function(){s.resize(document.documentElement.clientWidth,document.documentElement.clientHeight,h.world.height/h.world.width),s.render()},l=new m,n=new e,s=new o(document.querySelector("canvas")),h=new p,a=new r(1e3/30,(function(){s.drawMap(l.tile_set_image,h.world.tile_set.columns,h.world.map,h.world.columns,h.world.tile_set.tile_width,h.world.tile_set.tile_height);var t=h.world.tile_set.helicopter_frames[h.world.player.helicopter.frame_value];s.drawObject(l.tile_set_image,t.x,t.y,h.world.player.helicopter.x,h.world.player.helicopter.y,t.width,t.height,48,13);var e=h.world.tile_set.player_frames[h.world.player.frame_value];s.drawObject(l.tile_set_image,e.x,e.y,h.world.player.x,h.world.player.y,e.width,e.height,69,97),s.render()}),(function(){n.left.active||n.right.active?n.left.active?h.world.player.moveLeft():h.world.player.moveRight():h.world.player.stop(),n.up.active?h.world.player.fly():h.world.player.fall(),h.update()}));s.buffer.canvas.height=h.world.height,s.buffer.canvas.width=h.world.width,s.buffer.imageSmoothingEnabled=!0,l.loadTileSetImage("images/map.png",(function(){i(),a.start()})),window.addEventListener("keydown",t),window.addEventListener("keyup",t),window.addEventListener("resize",i)}))})();